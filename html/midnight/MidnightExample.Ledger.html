<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>MidnightExample.Ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Introduction}

</a><a id="25" class="Markup">\begin{code}[hide]</a>
<a id="44" class="Symbol">{-#</a> <a id="48" class="Keyword">OPTIONS</a> <a id="56" class="Pragma">--safe</a> <a id="63" class="Symbol">#-}</a>
<a id="67" class="Keyword">open</a> <a id="72" class="Keyword">import</a> <a id="79" href="Interface.DecEq.html" class="Module">Interface.DecEq</a>
<a id="95" class="Keyword">open</a> <a id="100" class="Keyword">import</a> <a id="107" href="Interface.Hashable.html" class="Module">Interface.Hashable</a>

<a id="127" class="Keyword">open</a> <a id="132" class="Keyword">import</a> <a id="139" href="Prelude.html" class="Module">Prelude</a> <a id="147" class="Keyword">hiding</a> <a id="154" class="Symbol">(</a><a id="155" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">_+_</a><a id="158" class="Symbol">;</a> <a id="160" href="Data.Nat.Base.html#1301" class="Primitive Operator">_&lt;ᵇ_</a><a id="164" class="Symbol">;</a> <a id="166" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a><a id="169" class="Symbol">)</a> <a id="171" class="Keyword">renaming</a> <a id="180" class="Symbol">(</a><a id="181" href="Data.Product.Base.html#1109" class="Function Operator">_×_</a> <a id="185" class="Symbol">to</a> <a id="188" class="Function Operator">_∧_</a><a id="191" class="Symbol">)</a>
<a id="193" class="Keyword">open</a> <a id="198" class="Keyword">import</a> <a id="205" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="220" class="Keyword">using</a> <a id="226" class="Symbol">(</a><a id="227" href="Axiom.Set.Sum.html#1617" class="Function">indexedSumL</a><a id="238" class="Symbol">)</a>
<a id="240" class="Keyword">open</a> <a id="245" class="Keyword">import</a> <a id="252" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="265" class="Keyword">hiding</a> <a id="272" class="Symbol">(</a><a id="273" href="Data.Integer.Base.html#6052" class="Function Operator">_/_</a><a id="276" class="Symbol">;</a> <a id="278" href="Data.Integer.Properties.html#2111" class="Function Operator">_≟_</a><a id="281" class="Symbol">)</a>

<a id="284" class="Keyword">module</a> <a id="291" href="MidnightExample.Ledger.html" class="Module">MidnightExample.Ledger</a> <a id="314" class="Symbol">(</a><a id="315" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a> <a id="320" class="Symbol">:</a> <a id="322" href="Agda.Primitive.html#320" class="Primitive">Set</a><a id="325" class="Symbol">)</a> <a id="327" class="Symbol">⦃</a> <a id="329" href="MidnightExample.Ledger.html#329" class="Bound">_</a> <a id="331" class="Symbol">:</a> <a id="333" href="Interface.DecEq.html#185" class="Record">DecEq</a> <a id="339" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a> <a id="344" class="Symbol">⦄</a>
  <a id="348" class="Symbol">⦃</a> <a id="350" href="MidnightExample.Ledger.html#350" class="Bound">_</a> <a id="352" class="Symbol">:</a> <a id="354" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="363" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a> <a id="365" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a> <a id="370" class="Symbol">⦄</a> <a id="372" class="Symbol">⦃</a> <a id="374" href="MidnightExample.Ledger.html#374" class="Bound">_</a> <a id="376" class="Symbol">:</a> <a id="378" href="Interface.Hashable.html#155" class="Function">Hashable₁</a> <a id="388" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="393" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a> <a id="398" class="Symbol">⦄</a> <a id="400" class="Symbol">⦃</a> <a id="402" href="MidnightExample.Ledger.html#402" class="Bound">_</a> <a id="404" class="Symbol">:</a> <a id="406" href="Interface.Hashable.html#269" class="Function">Hashable₂</a> <a id="416" href="MidnightExample.Ledger.html#188" class="Function Operator">_∧_</a> <a id="420" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a> <a id="425" class="Symbol">⦄</a> <a id="427" class="Keyword">where</a>

<a id="434" class="Keyword">open</a> <a id="439" class="Keyword">import</a> <a id="446" href="Data.Integer.Properties.html" class="Module">Data.Integer.Properties</a> <a id="470" class="Keyword">using</a> <a id="476" class="Symbol">(</a><a id="477" href="Data.Integer.Properties.html#31484" class="Function">+-0-commutativeMonoid</a><a id="498" class="Symbol">;</a> <a id="500" href="Data.Integer.Properties.html#31618" class="Function">+-0-abelianGroup</a><a id="516" class="Symbol">)</a>
<a id="518" class="Keyword">open</a> <a id="523" class="Keyword">import</a> <a id="530" href="Relation.Nullary.html" class="Module">Relation.Nullary</a>

<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Interface.Decidable.Instance.html" class="Module">Interface.Decidable.Instance</a>

<a id="590" class="Keyword">open</a> <a id="595" class="Keyword">import</a> <a id="602" href="Interface.ComputationalRelation.html" class="Module">Interface.ComputationalRelation</a>
<a id="634" class="Keyword">open</a> <a id="639" class="Keyword">import</a> <a id="646" href="Tactic.DeriveComp.html" class="Module">Tactic.DeriveComp</a>
<a id="664" class="Keyword">open</a> <a id="669" class="Keyword">import</a> <a id="676" href="MyDebugOptions.html" class="Module">MyDebugOptions</a>

<a id="692" class="Keyword">instance</a>
  <a id="703" href="MidnightExample.Ledger.html#703" class="Function">_</a> <a id="705" class="Symbol">=</a> <a id="707" href="Data.Integer.Properties.html#31484" class="Function">+-0-commutativeMonoid</a>

  <a id="Hashable-ℕ"></a><a id="732" href="MidnightExample.Ledger.html#732" class="Function">Hashable-ℕ</a> <a id="743" class="Symbol">:</a> <a id="745" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="754" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="756" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a>
  <a id="763" href="MidnightExample.Ledger.html#732" class="Function">Hashable-ℕ</a> <a id="774" class="Symbol">.</a><a id="775" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="780" href="MidnightExample.Ledger.html#780" class="Bound">n</a> <a id="782" class="Symbol">=</a> <a id="784" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="789" class="Symbol">(</a><a id="790" href="Agda.Builtin.Int.html#246" class="InductiveConstructor Operator">+</a> <a id="792" href="MidnightExample.Ledger.html#780" class="Bound">n</a><a id="793" class="Symbol">)</a>

<a id="_&lt;ᵇ_"></a><a id="796" href="MidnightExample.Ledger.html#796" class="Function Operator">_&lt;ᵇ_</a> <a id="801" class="Symbol">:</a> <a id="803" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="809" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="811" class="Symbol">→</a> <a id="813" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="819" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="821" class="Symbol">→</a> <a id="823" href="Agda.Builtin.Bool.html#156" class="Datatype">Bool</a>
<a id="828" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="833" href="MidnightExample.Ledger.html#833" class="Bound">a</a>  <a id="836" href="MidnightExample.Ledger.html#796" class="Function Operator">&lt;ᵇ</a> <a id="839" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="844" href="MidnightExample.Ledger.html#844" class="Bound">b</a>  <a id="847" class="Symbol">=</a> <a id="849" href="MidnightExample.Ledger.html#833" class="Bound">a</a> <a id="851" href="Data.Nat.Base.html#1301" class="Primitive Operator">Prelude.&lt;ᵇ</a> <a id="862" href="MidnightExample.Ledger.html#844" class="Bound">b</a>
<a id="864" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="869" href="MidnightExample.Ledger.html#869" class="Bound">a</a>  <a id="872" href="MidnightExample.Ledger.html#796" class="Function Operator">&lt;ᵇ</a> <a id="875" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="883" class="Symbol">=</a> <a id="885" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="891" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="899" href="MidnightExample.Ledger.html#796" class="Function Operator">&lt;ᵇ</a> <a id="902" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="907" href="MidnightExample.Ledger.html#907" class="Bound">b</a>  <a id="910" class="Symbol">=</a> <a id="912" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>
<a id="917" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="925" href="MidnightExample.Ledger.html#796" class="Function Operator">&lt;ᵇ</a> <a id="928" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="936" class="Symbol">=</a> <a id="938" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>
<a id="944" class="Markup">\end{code}</a><a id="954" class="Background">

This is a small example of a ledger specification for Midnight. It
only assumes that we know how to hash some types and provides a step
function for the ledger together with a proof of a non-trivial
property.

\section{Epochs \&amp; Consensus}

We define the number of slots in an epoch and a conversion function
from slots to epochs here, as well as a structure to refer to certain
points in the chain.

\begin{figure*}[h]
\AgdaTarget{Point, slot, blockHash, slotsInEpoch, epochOf}
</a><a id="1435" class="Markup">\begin{code}</a>
<a id="1448" class="Keyword">record</a> <a id="Point"></a><a id="1455" href="MidnightExample.Ledger.html#1455" class="Record">Point</a> <a id="1461" class="Symbol">:</a> <a id="1463" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1467" class="Keyword">where</a>
  <a id="1475" class="Keyword">field</a>  <a id="Point.slot"></a><a id="1482" href="MidnightExample.Ledger.html#1482" class="Field">slot</a>       <a id="1493" class="Symbol">:</a> <a id="1495" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1501" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Point.blockHash"></a><a id="1512" href="MidnightExample.Ledger.html#1512" class="Field">blockHash</a>  <a id="1523" class="Symbol">:</a> <a id="1525" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a>

<a id="slotsInEpoch"></a><a id="1531" href="MidnightExample.Ledger.html#1531" class="Function">slotsInEpoch</a> <a id="1544" class="Symbol">:</a> <a id="1546" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="1548" href="MidnightExample.Ledger.html#1531" class="Function">slotsInEpoch</a> <a id="1561" class="Symbol">=</a> <a id="1563" class="Number">50</a>

<a id="epochOf"></a><a id="1567" href="MidnightExample.Ledger.html#1567" class="Function">epochOf</a> <a id="1575" class="Symbol">:</a> <a id="1577" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1583" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1585" class="Symbol">→</a> <a id="1587" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1593" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="1595" href="MidnightExample.Ledger.html#1567" class="Function">epochOf</a> <a id="1603" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>  <a id="1612" class="Symbol">=</a> <a id="1614" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="1622" href="MidnightExample.Ledger.html#1567" class="Function">epochOf</a> <a id="1630" class="Symbol">(</a><a id="1631" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1636" href="MidnightExample.Ledger.html#1636" class="Bound">s</a><a id="1637" class="Symbol">)</a> <a id="1639" class="Symbol">=</a> <a id="1641" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1646" class="Symbol">(</a><a id="1647" href="MidnightExample.Ledger.html#1636" class="Bound">s</a> <a id="1649" href="Data.Nat.Base.html#5077" class="Function Operator">/</a> <a id="1651" href="MidnightExample.Ledger.html#1531" class="Function">slotsInEpoch</a><a id="1663" class="Symbol">)</a>
<a id="1665" class="Markup">\end{code}</a><a id="1675" class="Background">
\caption{Point- and epoch-related definitions}
\end{figure*}

\newpage

\section{Transactions \&amp; Blocks}

Transactions can increment or decrement a counter that is stored in
the ledger, and blocks consist of a list of transactions and a header,
which contains some meta-information about the block. We also use the
accessor functions of the headers transitively, to access fields in
the header given the body.

\begin{figure*}[h]
\AgdaTarget{Tx, inc, dec, txDelta}
</a><a id="2141" class="Markup">\begin{code}</a>
<a id="2154" class="Keyword">data</a> <a id="Tx"></a><a id="2159" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a> <a id="2162" class="Symbol">:</a> <a id="2164" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2168" class="Keyword">where</a>
  <a id="Tx.inc"></a><a id="2176" href="MidnightExample.Ledger.html#2176" class="InductiveConstructor">inc</a>  <a id="2181" class="Symbol">:</a> <a id="2183" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a>
  <a id="Tx.dec"></a><a id="2188" href="MidnightExample.Ledger.html#2188" class="InductiveConstructor">dec</a>  <a id="2193" class="Symbol">:</a> <a id="2195" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a>

<a id="txDelta"></a><a id="2199" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="2207" class="Symbol">:</a> <a id="2209" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a> <a id="2212" class="Symbol">→</a> <a id="2214" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
<a id="2216" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="2224" href="MidnightExample.Ledger.html#2176" class="InductiveConstructor">inc</a>  <a id="2229" class="Symbol">=</a> <a id="2231" href="Data.Integer.Base.html#1558" class="Function">1ℤ</a>
<a id="2234" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="2242" href="MidnightExample.Ledger.html#2188" class="InductiveConstructor">dec</a>  <a id="2247" class="Symbol">=</a> <a id="2249" href="Data.Integer.Base.html#1534" class="Function">-1ℤ</a>
<a id="2253" class="Markup">\end{code}</a><a id="2263" class="Background">
</a><a id="2264" class="Markup">\begin{code}[hide]</a>
<a id="2283" class="Keyword">instance</a>
  <a id="Hashable-Tx"></a><a id="2294" href="MidnightExample.Ledger.html#2294" class="Function">Hashable-Tx</a> <a id="2306" class="Symbol">:</a> <a id="2308" href="Interface.Hashable.html#64" class="Record">Hashable</a> <a id="2317" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a> <a id="2320" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a>
  <a id="2327" href="MidnightExample.Ledger.html#2294" class="Function">Hashable-Tx</a> <a id="2339" class="Symbol">.</a><a id="2340" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="2345" class="Symbol">=</a> <a id="2347" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="2352" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="2354" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a>
<a id="2362" class="Markup">\end{code}</a><a id="2372" class="Background">
\caption{Transactions}
\end{figure*}
\begin{figure*}[h]
\AgdaTarget{Header, slotNo, blockNo, blockHash, prev, nodeId, Block, header, body, blockPoint, computeBlockHash, addBlockHash}
</a><a id="2556" class="Markup">\begin{code}</a>
<a id="2569" class="Keyword">record</a> <a id="Header"></a><a id="2576" href="MidnightExample.Ledger.html#2576" class="Record">Header</a> <a id="2583" class="Symbol">:</a> <a id="2585" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2589" class="Keyword">where</a>
  <a id="2597" class="Keyword">field</a>  <a id="Header.slotNo"></a><a id="2604" href="MidnightExample.Ledger.html#2604" class="Field">slotNo</a>     <a id="2615" class="Symbol">:</a> <a id="2617" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.blockNo"></a><a id="2628" href="MidnightExample.Ledger.html#2628" class="Field">blockNo</a>    <a id="2639" class="Symbol">:</a> <a id="2641" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.blockHash"></a><a id="2652" href="MidnightExample.Ledger.html#2652" class="Field">blockHash</a>  <a id="2663" class="Symbol">:</a> <a id="2665" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a>
         <a id="Header.prev"></a><a id="2679" href="MidnightExample.Ledger.html#2679" class="Field">prev</a>       <a id="2690" class="Symbol">:</a> <a id="2692" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
         <a id="Header.nodeId"></a><a id="2703" href="MidnightExample.Ledger.html#2703" class="Field">nodeId</a>     <a id="2714" class="Symbol">:</a> <a id="2716" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>

<a id="2719" class="Keyword">record</a> <a id="Block"></a><a id="2726" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="2732" class="Symbol">:</a> <a id="2734" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2738" class="Keyword">where</a>
  <a id="2746" class="Keyword">field</a>  <a id="Block.header"></a><a id="2753" href="MidnightExample.Ledger.html#2753" class="Field">header</a>  <a id="2761" class="Symbol">:</a> <a id="2763" href="MidnightExample.Ledger.html#2576" class="Record">Header</a>
         <a id="Block.body"></a><a id="2779" href="MidnightExample.Ledger.html#2779" class="Field">body</a>    <a id="2787" class="Symbol">:</a> <a id="2789" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="2794" href="MidnightExample.Ledger.html#2159" class="Datatype">Tx</a>

  <a id="2800" class="Keyword">open</a> <a id="2805" href="MidnightExample.Ledger.html#2576" class="Module">Header</a> <a id="2812" href="MidnightExample.Ledger.html#2753" class="Field">header</a> <a id="2819" class="Keyword">public</a>

<a id="blockPoint"></a><a id="2827" href="MidnightExample.Ledger.html#2827" class="Function">blockPoint</a> <a id="2838" class="Symbol">:</a> <a id="2840" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="2846" class="Symbol">→</a> <a id="2848" href="MidnightExample.Ledger.html#1455" class="Record">Point</a>
<a id="2854" href="MidnightExample.Ledger.html#2827" class="Function">blockPoint</a> <a id="2865" href="MidnightExample.Ledger.html#2865" class="Bound">b</a> <a id="2867" class="Symbol">=</a> <a id="2869" class="Keyword">record</a> <a id="2876" class="Symbol">{</a> <a id="2878" href="MidnightExample.Ledger.html#1482" class="Field">slot</a> <a id="2883" class="Symbol">=</a> <a id="2885" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2890" href="MidnightExample.Ledger.html#2604" class="Function">slotNo</a> <a id="2897" class="Symbol">;</a> <a id="2899" href="MidnightExample.Ledger.html#1512" class="Field">blockHash</a> <a id="2909" class="Symbol">=</a> <a id="2911" href="MidnightExample.Ledger.html#2652" class="Function">blockHash</a> <a id="2921" class="Symbol">}</a>
  <a id="2925" class="Keyword">where</a> <a id="2931" class="Keyword">open</a> <a id="2936" href="MidnightExample.Ledger.html#2726" class="Module">Block</a> <a id="2942" href="MidnightExample.Ledger.html#2865" class="Bound">b</a>

<a id="computeBlockHash"></a><a id="2945" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="2962" class="Symbol">:</a> <a id="2964" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="2970" class="Symbol">→</a> <a id="2972" href="MidnightExample.Ledger.html#315" class="Bound">Hash</a>
<a id="2977" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="2994" href="MidnightExample.Ledger.html#2994" class="Bound">b</a> <a id="2996" class="Symbol">=</a> <a id="2998" href="Interface.Hashable.html#109" class="Field">hash</a> <a id="3003" class="Symbol">(</a><a id="3004" href="MidnightExample.Ledger.html#2604" class="Function">slotNo</a> <a id="3011" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3013" href="MidnightExample.Ledger.html#2628" class="Function">blockNo</a> <a id="3021" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3023" href="MidnightExample.Ledger.html#2679" class="Function">prev</a> <a id="3028" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3030" href="MidnightExample.Ledger.html#2779" class="Field">body</a><a id="3034" class="Symbol">)</a>
  <a id="3038" class="Keyword">where</a> <a id="3044" class="Keyword">open</a> <a id="3049" href="MidnightExample.Ledger.html#2726" class="Module">Block</a> <a id="3055" href="MidnightExample.Ledger.html#2994" class="Bound">b</a>

<a id="addBlockHash"></a><a id="3058" href="MidnightExample.Ledger.html#3058" class="Function">addBlockHash</a> <a id="3071" class="Symbol">:</a> <a id="3073" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="3079" class="Symbol">→</a> <a id="3081" href="MidnightExample.Ledger.html#2726" class="Record">Block</a>
<a id="3087" href="MidnightExample.Ledger.html#3058" class="Function">addBlockHash</a> <a id="3100" href="MidnightExample.Ledger.html#3100" class="Bound">b</a> <a id="3102" class="Symbol">=</a> <a id="3104" class="Keyword">record</a> <a id="3111" href="MidnightExample.Ledger.html#3100" class="Bound">b</a> <a id="3113" class="Symbol">{</a> <a id="3115" href="MidnightExample.Ledger.html#2753" class="Field">header</a> <a id="3122" class="Symbol">=</a> <a id="3124" class="Keyword">record</a> <a id="3131" href="MidnightExample.Ledger.html#2753" class="Field">header</a> <a id="3138" class="Symbol">{</a> <a id="3140" href="MidnightExample.Ledger.html#2652" class="Field">blockHash</a> <a id="3150" class="Symbol">=</a> <a id="3152" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="3169" href="MidnightExample.Ledger.html#3100" class="Bound">b</a> <a id="3171" class="Symbol">}</a> <a id="3173" class="Symbol">}</a>
  <a id="3177" class="Keyword">where</a> <a id="3183" class="Keyword">open</a> <a id="3188" href="MidnightExample.Ledger.html#2726" class="Module">Block</a> <a id="3194" href="MidnightExample.Ledger.html#3100" class="Bound">b</a>
<a id="3196" class="Markup">\end{code}</a><a id="3206" class="Background">
\caption{Blocks and functions related to them}
\end{figure*}

\newpage

\section{Ledger}

The ledger state consists of a pointer to the previous block as well as a counter and two snapshots. Ticking a ledger state means to roll over the snapshots.
\begin{figure*}[h]
\AgdaTarget{LedgerState, tip, count, snapshot1, snapshot2, tickLedgerState}
\begin{AgdaSuppressSpace}
</a><a id="3576" class="Markup">\begin{code}</a>
<a id="3589" class="Keyword">record</a> <a id="LedgerState"></a><a id="3596" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="3608" class="Symbol">:</a> <a id="3610" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="3614" class="Keyword">where</a>
  <a id="3622" class="Keyword">field</a>  <a id="LedgerState.tip"></a><a id="3629" href="MidnightExample.Ledger.html#3629" class="Field">tip</a>                  <a id="3650" class="Symbol">:</a> <a id="3652" href="MidnightExample.Ledger.html#1455" class="Record">Point</a>
         <a id="LedgerState.count"></a><a id="3667" href="MidnightExample.Ledger.html#3667" class="Field">count</a>                <a id="3688" class="Symbol">:</a> <a id="3690" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>
         <a id="LedgerState.snapshot1"></a><a id="3701" href="MidnightExample.Ledger.html#3701" class="Field">snapshot1</a> <a id="LedgerState.snapshot2"></a><a id="3711" href="MidnightExample.Ledger.html#3711" class="Field">snapshot2</a>  <a id="3722" class="Symbol">:</a> <a id="3724" href="Agda.Builtin.Int.html#228" class="Datatype">ℤ</a>

<a id="3727" class="Markup">\end{code}</a><a id="3737" class="Background">
</a><a id="3738" class="Markup">\begin{code}[hide]</a>
<a id="3757" class="Keyword">open</a> <a id="3762" href="MidnightExample.Ledger.html#3596" class="Module">LedgerState</a>
<a id="3774" class="Markup">\end{code}</a><a id="3784" class="Background">
</a><a id="3785" class="Markup">\begin{code}</a>
<a id="tickLedgerState"></a><a id="3798" href="MidnightExample.Ledger.html#3798" class="Function">tickLedgerState</a> <a id="3814" class="Symbol">:</a> <a id="3816" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="3818" class="Symbol">→</a> <a id="3820" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="3832" class="Symbol">→</a> <a id="3834" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a>
<a id="3846" href="MidnightExample.Ledger.html#3798" class="Function">tickLedgerState</a> <a id="3862" href="MidnightExample.Ledger.html#3862" class="Bound">newSlot</a> <a id="3870" href="MidnightExample.Ledger.html#3870" class="Bound">st</a> <a id="3873" class="Symbol">=</a> <a id="3875" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="3878" href="MidnightExample.Ledger.html#3976" class="Function">isNewEpoch</a>
  <a id="3891" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="3896" class="Keyword">record</a> <a id="3903" href="MidnightExample.Ledger.html#3870" class="Bound">st</a> <a id="3906" class="Symbol">{</a> <a id="3908" href="MidnightExample.Ledger.html#3701" class="Field">snapshot1</a> <a id="3918" class="Symbol">=</a> <a id="3920" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="3926" href="MidnightExample.Ledger.html#3870" class="Bound">st</a> <a id="3929" class="Symbol">;</a> <a id="3931" href="MidnightExample.Ledger.html#3711" class="Field">snapshot2</a> <a id="3941" class="Symbol">=</a> <a id="3943" href="MidnightExample.Ledger.html#3701" class="Field">snapshot1</a> <a id="3953" href="MidnightExample.Ledger.html#3870" class="Bound">st</a> <a id="3956" class="Symbol">}</a>
  <a id="3960" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="3965" href="MidnightExample.Ledger.html#3870" class="Bound">st</a>
  <a id="3970" class="Keyword">where</a> <a id="3976" href="MidnightExample.Ledger.html#3976" class="Function">isNewEpoch</a> <a id="3987" class="Symbol">=</a> <a id="3989" href="MidnightExample.Ledger.html#1567" class="Function">epochOf</a> <a id="3997" class="Symbol">(</a><a id="3998" href="MidnightExample.Ledger.html#1482" class="Field">Point.slot</a> <a id="4009" class="Symbol">(</a><a id="4010" href="MidnightExample.Ledger.html#3629" class="Field">tip</a> <a id="4014" href="MidnightExample.Ledger.html#3870" class="Bound">st</a><a id="4016" class="Symbol">))</a> <a id="4019" href="MidnightExample.Ledger.html#796" class="Function Operator">&lt;ᵇ</a> <a id="4022" href="MidnightExample.Ledger.html#1567" class="Function">epochOf</a> <a id="4030" class="Symbol">(</a><a id="4031" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="4036" href="MidnightExample.Ledger.html#3862" class="Bound">newSlot</a><a id="4043" class="Symbol">)</a>
<a id="4045" class="Markup">\end{code}</a><a id="4055" class="Background">
\end{AgdaSuppressSpace}
\caption{Ledger state and its tick function}
\end{figure*}

The ledger transition system updates the tip to point to the most
recent applied block, and increments/decrements the counter according
to the transactions. We also want to check some non-trivial
conditions, so we require the change to the counter to be non-zero and
that the hash in the header is correct.

\begin{figure*}[h]
\AgdaTarget{\_⊢\_⇀⦇\_,LEDGER⦈\_, LEDGER-inductive}
</a><a id="4518" class="Markup">\begin{code}</a>
<a id="4531" class="Keyword">data</a> <a id="_⊢_⇀⦇_,LEDGER⦈_"></a><a id="4536" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a> <a id="4552" class="Symbol">:</a> <a id="4554" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a> <a id="4556" class="Symbol">→</a> <a id="4558" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="4570" class="Symbol">→</a> <a id="4572" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="4578" class="Symbol">→</a> <a id="4580" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="4592" class="Symbol">→</a> <a id="4594" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="4598" class="Keyword">where</a>
  <a id="_⊢_⇀⦇_,LEDGER⦈_.LEDGER-inductive"></a><a id="4606" href="MidnightExample.Ledger.html#4606" class="InductiveConstructor">LEDGER-inductive</a> <a id="4623" class="Symbol">:</a> <a id="4625" class="Symbol">∀</a> <a id="4627" class="Symbol">{</a><a id="4628" href="MidnightExample.Ledger.html#4628" class="Bound">Γ</a><a id="4629" class="Symbol">}</a> <a id="4631" class="Symbol">{</a><a id="4632" href="MidnightExample.Ledger.html#4632" class="Bound">s</a><a id="4633" class="Symbol">}</a> <a id="4635" class="Symbol">{</a><a id="4636" href="MidnightExample.Ledger.html#4636" class="Bound">b</a><a id="4637" class="Symbol">}</a> <a id="4639" class="Symbol">→</a>
    <a id="4645" class="Keyword">let</a> <a id="4649" class="Keyword">open</a> <a id="4654" href="MidnightExample.Ledger.html#2726" class="Module">Block</a> <a id="4660" href="MidnightExample.Ledger.html#4636" class="Bound">b</a>
        <a id="4670" href="MidnightExample.Ledger.html#4670" class="Bound">acc</a> <a id="4674" class="Symbol">=</a> <a id="4676" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="4680" href="MidnightExample.Ledger.html#4680" class="Bound">x</a> <a id="4682" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="4684" href="MidnightExample.Ledger.html#2779" class="Field">body</a> <a id="4689" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="4691" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="4699" href="MidnightExample.Ledger.html#4680" class="Bound">x</a>
        <a id="4709" href="MidnightExample.Ledger.html#4709" class="Bound">s&#39;</a>  <a id="4713" class="Symbol">=</a> <a id="4715" href="MidnightExample.Ledger.html#3798" class="Function">tickLedgerState</a> <a id="4731" href="MidnightExample.Ledger.html#2604" class="Function">slotNo</a> <a id="4738" href="MidnightExample.Ledger.html#4632" class="Bound">s</a>
    <a id="4744" class="Keyword">in</a> <a id="4747" href="Interface.ComputationalRelation.html#412" class="Function Operator">∙</a> <a id="4749" href="MidnightExample.Ledger.html#4670" class="Bound">acc</a> <a id="4753" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="4755" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a>        <a id="4765" href="Interface.ComputationalRelation.html#375" class="Function Operator">∙</a> <a id="4767" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="4784" href="MidnightExample.Ledger.html#4636" class="Bound">b</a> <a id="4786" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4788" href="MidnightExample.Ledger.html#2652" class="Function">blockHash</a>
    <a id="4802" href="Interface.ComputationalRelation.html#276" class="Function Operator">────────────────────────────────</a>
    <a id="4839" href="MidnightExample.Ledger.html#4628" class="Bound">Γ</a> <a id="4841" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">⊢</a> <a id="4843" href="MidnightExample.Ledger.html#4632" class="Bound">s</a> <a id="4845" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">⇀⦇</a> <a id="4848" href="MidnightExample.Ledger.html#4636" class="Bound">b</a> <a id="4850" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">,LEDGER⦈</a>
      <a id="4865" class="Keyword">record</a> <a id="4872" href="MidnightExample.Ledger.html#4709" class="Bound">s&#39;</a> <a id="4875" class="Symbol">{</a> <a id="4877" href="MidnightExample.Ledger.html#3629" class="Field">tip</a> <a id="4881" class="Symbol">=</a> <a id="4883" href="MidnightExample.Ledger.html#2827" class="Function">blockPoint</a> <a id="4894" href="MidnightExample.Ledger.html#4636" class="Bound">b</a> <a id="4896" class="Symbol">;</a> <a id="4898" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="4904" class="Symbol">=</a> <a id="4906" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="4912" href="MidnightExample.Ledger.html#4632" class="Bound">s</a> <a id="4914" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="4916" href="MidnightExample.Ledger.html#4670" class="Bound">acc</a> <a id="4920" class="Symbol">}</a>
<a id="4922" class="Markup">\end{code}</a><a id="4932" class="Background">
\caption{The LEDGER transition system}
\end{figure*}

We also have automation that generates a step function for this
relation. As an example, we also provide a function that does the same
computation explicitly.

</a><a id="5147" class="Markup">\begin{code}[hide]</a>
<a id="5166" class="Keyword">unquoteDecl</a> <a id="Computational-LEDGER"></a><a id="5178" href="MidnightExample.Ledger.html#5178" class="Function">Computational-LEDGER</a> <a id="5199" class="Symbol">=</a> <a id="5201" href="Tactic.DeriveComp.html#5646" class="Function">deriveComputational</a> <a id="5221" class="Symbol">(</a><a id="5222" class="Keyword">quote</a> <a id="5228" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">_⊢_⇀⦇_,LEDGER⦈_</a><a id="5243" class="Symbol">)</a> <a id="5245" href="MidnightExample.Ledger.html#5178" class="Function">Computational-LEDGER</a>
<a id="5266" class="Keyword">open</a> <a id="5271" href="Interface.ComputationalRelation.html#570" class="Module">Computational</a> <a id="5285" href="MidnightExample.Ledger.html#5178" class="Function">Computational-LEDGER</a>
<a id="5306" class="Markup">\end{code}</a><a id="5316" class="Background">
\begin{figure*}[h]
</a><a id="5336" class="Markup">\begin{code}</a>
<a id="LEDGER-step"></a><a id="5349" href="MidnightExample.Ledger.html#5349" class="Function">LEDGER-step</a> <a id="5361" class="Symbol">:</a> <a id="5363" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a> <a id="5365" class="Symbol">→</a> <a id="5367" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="5379" class="Symbol">→</a> <a id="5381" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="5387" class="Symbol">→</a> <a id="5389" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5395" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a>
<a id="5407" href="MidnightExample.Ledger.html#5349" class="Function">LEDGER-step</a> <a id="5419" class="Symbol">=</a> <a id="5421" href="Interface.ComputationalRelation.html#644" class="Function">compute</a>

<a id="applyBlockTo"></a><a id="5430" href="MidnightExample.Ledger.html#5430" class="Function">applyBlockTo</a> <a id="5443" class="Symbol">:</a> <a id="5445" href="MidnightExample.Ledger.html#2726" class="Record">Block</a> <a id="5451" class="Symbol">→</a> <a id="5453" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a> <a id="5465" class="Symbol">→</a> <a id="5467" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="5473" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a>
<a id="5485" href="MidnightExample.Ledger.html#5430" class="Function">applyBlockTo</a> <a id="5498" href="MidnightExample.Ledger.html#5498" class="Bound">b</a> <a id="5500" href="MidnightExample.Ledger.html#5500" class="Bound">st</a> <a id="5503" class="Symbol">=</a> <a id="5505" class="Keyword">let</a> <a id="5509" href="MidnightExample.Ledger.html#5509" class="Bound">acc</a> <a id="5513" class="Symbol">=</a> <a id="5515" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="5519" href="MidnightExample.Ledger.html#5519" class="Bound">x</a> <a id="5521" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="5523" href="MidnightExample.Ledger.html#2779" class="Field">Block.body</a> <a id="5534" href="MidnightExample.Ledger.html#5498" class="Bound">b</a> <a id="5536" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="5538" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="5546" href="MidnightExample.Ledger.html#5519" class="Bound">x</a> <a id="5548" class="Keyword">in</a>
  <a id="5553" href="Interface.Decidable.Instance.html#663" class="Function Operator">ifᵈ</a> <a id="5557" href="MidnightExample.Ledger.html#5509" class="Bound">acc</a> <a id="5561" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="5563" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="5566" href="MidnightExample.Ledger.html#188" class="Function Operator">∧</a> <a id="5568" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="5585" href="MidnightExample.Ledger.html#5498" class="Bound">b</a> <a id="5587" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="5589" href="MidnightExample.Ledger.html#2652" class="Function">Block.blockHash</a> <a id="5605" href="MidnightExample.Ledger.html#5498" class="Bound">b</a>
    <a id="5611" href="Interface.Decidable.Instance.html#663" class="Function Operator">then</a> <a id="5616" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="5621" class="Keyword">record</a> <a id="5628" href="MidnightExample.Ledger.html#5500" class="Bound">st</a> <a id="5631" class="Symbol">{</a> <a id="5633" href="MidnightExample.Ledger.html#3629" class="Field">tip</a> <a id="5637" class="Symbol">=</a> <a id="5639" href="MidnightExample.Ledger.html#2827" class="Function">blockPoint</a> <a id="5650" href="MidnightExample.Ledger.html#5498" class="Bound">b</a> <a id="5652" class="Symbol">;</a> <a id="5654" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="5660" class="Symbol">=</a> <a id="5662" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="5668" href="MidnightExample.Ledger.html#5500" class="Bound">st</a> <a id="5671" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="5673" href="MidnightExample.Ledger.html#5509" class="Bound">acc</a> <a id="5677" class="Symbol">}</a>
    <a id="5683" href="Interface.Decidable.Instance.html#663" class="Function Operator">else</a> <a id="5688" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
<a id="5696" class="Markup">\end{code}</a><a id="5706" class="Background">
\end{figure*}

\newpage

\section{Key properties}

This is Agda, so we can prove some properties. Since we check very few
things, and just repeating properties that we do check isn&#39;t
interesting, here&#39;s the only non-trivial property that I could think
of: That the counter in the ledger state does change.

We present three proofs here, one using the STS, one using the step
function generated from the STS, and one using the
\AgdaFunction{applyBlockTo} function to show why using the STS is more
convenient for proofs: Instead of tracing the function control flow to
extract properties, we can simply pattern-match for them. After we
obtained fact that the sum of changes induced by transactions is
non-zero, the proofs are identical.

</a><a id="6444" class="Markup">\begin{code}[hide]</a>
<a id="6463" class="Keyword">private</a> <a id="6471" class="Keyword">variable</a> <a id="6480" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="6482" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a> <a id="6485" class="Symbol">:</a> <a id="6487" href="MidnightExample.Ledger.html#3596" class="Record">LedgerState</a>
                 <a id="6516" href="MidnightExample.Ledger.html#6516" class="Generalizable">b</a> <a id="6518" class="Symbol">:</a> <a id="6520" href="MidnightExample.Ledger.html#2726" class="Record">Block</a>

<a id="6527" class="Keyword">open</a> <a id="6532" class="Keyword">import</a> <a id="6539" href="Algebra.Properties.AbelianGroup.html" class="Module">Algebra.Properties.AbelianGroup</a> <a id="6571" href="Data.Integer.Properties.html#31618" class="Function">+-0-abelianGroup</a>
<a id="6588" class="Markup">\end{code}</a><a id="6598" class="Background">
\begin{figure*}[h]
</a><a id="6618" class="Markup">\begin{code}</a>
<a id="lemma"></a><a id="6631" href="MidnightExample.Ledger.html#6631" class="Function">lemma</a> <a id="6637" class="Symbol">:</a> <a id="6639" class="Symbol">∀</a> <a id="6641" class="Symbol">{</a><a id="6642" href="MidnightExample.Ledger.html#6642" class="Bound">x</a> <a id="6644" href="MidnightExample.Ledger.html#6644" class="Bound">y</a><a id="6645" class="Symbol">}</a> <a id="6647" class="Symbol">→</a> <a id="6649" href="MidnightExample.Ledger.html#6644" class="Bound">y</a> <a id="6651" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6653" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="6656" class="Symbol">→</a> <a id="6658" href="MidnightExample.Ledger.html#6642" class="Bound">x</a> <a id="6660" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6662" href="MidnightExample.Ledger.html#6642" class="Bound">x</a> <a id="6664" href="Data.Integer.Base.html#5004" class="Function Operator">+</a> <a id="6666" href="MidnightExample.Ledger.html#6644" class="Bound">y</a>
<a id="6668" href="MidnightExample.Ledger.html#6631" class="Function">lemma</a> <a id="6674" href="MidnightExample.Ledger.html#6674" class="Bound">y≢0</a> <a id="6678" href="MidnightExample.Ledger.html#6678" class="Bound">eq</a> <a id="6681" class="Symbol">=</a> <a id="6683" href="MidnightExample.Ledger.html#6674" class="Bound">y≢0</a> <a id="6687" class="Symbol">(</a><a id="6688" href="Algebra.Properties.Group.html#2443" class="Function">identityʳ-unique</a> <a id="6705" class="Symbol">_</a> <a id="6707" class="Symbol">_</a> <a id="6709" class="Symbol">(</a><a id="6710" href="Relation.Binary.PropositionalEquality.Core.html#1698" class="Function">sym</a> <a id="6714" href="MidnightExample.Ledger.html#6678" class="Bound">eq</a><a id="6716" class="Symbol">))</a>

<a id="LEDGER-property₁"></a><a id="6720" href="MidnightExample.Ledger.html#6720" class="Function">LEDGER-property₁</a> <a id="6737" class="Symbol">:</a> <a id="6739" class="Symbol">_</a> <a id="6741" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">⊢</a> <a id="6743" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="6745" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">⇀⦇</a> <a id="6748" href="MidnightExample.Ledger.html#6516" class="Generalizable">b</a> <a id="6750" href="MidnightExample.Ledger.html#4536" class="Datatype Operator">,LEDGER⦈</a> <a id="6759" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a> <a id="6762" class="Symbol">→</a> <a id="6764" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="6770" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="6772" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6774" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="6780" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a>
<a id="6783" href="MidnightExample.Ledger.html#6720" class="Function">LEDGER-property₁</a> <a id="6800" class="Symbol">(</a><a id="6801" href="MidnightExample.Ledger.html#4606" class="InductiveConstructor">LEDGER-inductive</a> <a id="6818" href="MidnightExample.Ledger.html#6818" class="Bound">acc≢0</a> <a id="6824" class="Symbol">_)</a> <a id="6827" class="Symbol">=</a> <a id="6829" href="MidnightExample.Ledger.html#6631" class="Function">lemma</a> <a id="6835" href="MidnightExample.Ledger.html#6818" class="Bound">acc≢0</a>

<a id="LEDGER-property₂"></a><a id="6842" href="MidnightExample.Ledger.html#6842" class="Function">LEDGER-property₂</a> <a id="6859" class="Symbol">:</a> <a id="6861" href="MidnightExample.Ledger.html#5349" class="Function">LEDGER-step</a> <a id="6873" class="Symbol">_</a> <a id="6875" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="6877" href="MidnightExample.Ledger.html#6516" class="Generalizable">b</a> <a id="6879" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="6881" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="6886" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a> <a id="6889" class="Symbol">→</a> <a id="6891" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="6897" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="6899" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="6901" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="6907" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a>
<a id="6910" href="MidnightExample.Ledger.html#6842" class="Function">LEDGER-property₂</a> <a id="6927" class="Symbol">{</a><a id="6928" href="MidnightExample.Ledger.html#6928" class="Bound">s</a><a id="6929" class="Symbol">}</a> <a id="6931" class="Symbol">{</a><a id="6932" href="MidnightExample.Ledger.html#6932" class="Bound">b</a><a id="6933" class="Symbol">}</a> <a id="6935" href="MidnightExample.Ledger.html#6935" class="Bound">eq</a> <a id="6938" class="Keyword">with</a> <a id="6943" href="Function.Bundles.html#4398" class="Field">Equivalence.to</a> <a id="6958" class="Symbol">(</a><a id="6959" href="Interface.ComputationalRelation.html#682" class="Function">≡-just⇔STS</a> <a id="6970" class="Symbol">{</a><a id="6971" class="Argument">s</a> <a id="6973" class="Symbol">=</a> <a id="6975" href="MidnightExample.Ledger.html#6928" class="Bound">s</a><a id="6976" class="Symbol">}</a> <a id="6978" class="Symbol">{</a><a id="6979" class="Argument">sig</a> <a id="6983" class="Symbol">=</a> <a id="6985" href="MidnightExample.Ledger.html#6932" class="Bound">b</a><a id="6986" class="Symbol">})</a> <a id="6989" href="MidnightExample.Ledger.html#6935" class="Bound">eq</a>
<a id="6992" class="Symbol">...</a> <a id="6996" class="Symbol">|</a> <a id="6998" class="Symbol">(</a><a id="6999" href="MidnightExample.Ledger.html#4606" class="InductiveConstructor">LEDGER-inductive</a> <a id="7016" href="MidnightExample.Ledger.html#7016" class="Bound">acc≢0</a> <a id="7022" class="Symbol">_)</a> <a id="7025" class="Symbol">=</a> <a id="7027" href="MidnightExample.Ledger.html#6631" class="Function">lemma</a> <a id="7033" href="MidnightExample.Ledger.html#7016" class="Bound">acc≢0</a>

<a id="LEDGER-property₃"></a><a id="7040" href="MidnightExample.Ledger.html#7040" class="Function">LEDGER-property₃</a> <a id="7057" class="Symbol">:</a> <a id="7059" href="MidnightExample.Ledger.html#5430" class="Function">applyBlockTo</a> <a id="7072" href="MidnightExample.Ledger.html#6516" class="Generalizable">b</a> <a id="7074" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="7076" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="7078" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="7083" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a> <a id="7086" class="Symbol">→</a> <a id="7088" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="7094" href="MidnightExample.Ledger.html#6480" class="Generalizable">s</a> <a id="7096" href="Relation.Binary.PropositionalEquality.Core.html#844" class="Function Operator">≢</a> <a id="7098" href="MidnightExample.Ledger.html#3667" class="Field">count</a> <a id="7104" href="MidnightExample.Ledger.html#6482" class="Generalizable">s&#39;</a>
<a id="7107" href="MidnightExample.Ledger.html#7040" class="Function">LEDGER-property₃</a> <a id="7124" class="Symbol">{</a><a id="7125" class="Argument">b</a> <a id="7127" class="Symbol">=</a> <a id="7129" href="MidnightExample.Ledger.html#7129" class="Bound">b</a><a id="7130" class="Symbol">}</a> <a id="7132" href="MidnightExample.Ledger.html#7132" class="Bound">h</a> <a id="7134" class="Keyword">with</a>
  <a id="7141" class="Symbol">(</a><a id="7142" href="Axiom.Set.Sum.html#1617" class="Function">Σˡ[</a> <a id="7146" href="MidnightExample.Ledger.html#7146" class="Bound">x</a> <a id="7148" href="Axiom.Set.Sum.html#1617" class="Function">←</a> <a id="7150" href="MidnightExample.Ledger.html#2779" class="Field">Block.body</a> <a id="7161" href="MidnightExample.Ledger.html#7129" class="Bound">b</a> <a id="7163" href="Axiom.Set.Sum.html#1617" class="Function">]</a> <a id="7165" href="MidnightExample.Ledger.html#2199" class="Function">txDelta</a> <a id="7173" href="MidnightExample.Ledger.html#7146" class="Bound">x</a><a id="7174" class="Symbol">)</a> <a id="7176" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="7178" href="Data.Integer.Base.html#1518" class="Function">0ℤ</a> <a id="7181" class="Symbol">|</a> <a id="7183" href="MidnightExample.Ledger.html#2945" class="Function">computeBlockHash</a> <a id="7200" href="MidnightExample.Ledger.html#7129" class="Bound">b</a> <a id="7202" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="7204" href="MidnightExample.Ledger.html#2652" class="Function">Block.blockHash</a> <a id="7220" href="MidnightExample.Ledger.html#7129" class="Bound">b</a> <a id="7222" class="Symbol">|</a> <a id="7224" href="MidnightExample.Ledger.html#7132" class="Bound">h</a>
<a id="7226" class="Symbol">...</a> <a id="7230" class="Symbol">|</a> <a id="7232" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7235" href="MidnightExample.Ledger.html#7235" class="Bound">acc≢0</a> <a id="7241" class="Symbol">|</a> <a id="7243" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="7247" class="Symbol">_</a> <a id="7249" class="Symbol">|</a> <a id="7251" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="7256" class="Symbol">=</a> <a id="7258" href="MidnightExample.Ledger.html#6631" class="Function">lemma</a> <a id="7264" href="MidnightExample.Ledger.html#7235" class="Bound">acc≢0</a>
<a id="7270" class="Symbol">...</a> <a id="7274" class="Symbol">|</a> <a id="7276" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7279" class="Symbol">_</a>     <a id="7285" class="Symbol">|</a> <a id="7287" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="7290" class="Symbol">_</a>  <a id="7293" class="Symbol">|</a> <a id="7295" class="Symbol">()</a>
<a id="7298" class="Symbol">...</a> <a id="7302" class="Symbol">|</a> <a id="7304" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="7308" class="Symbol">_</a>    <a id="7313" class="Symbol">|</a> <a id="7315" class="Symbol">_</a>     <a id="7321" class="Symbol">|</a> <a id="7323" class="Symbol">()</a>
<a id="7326" class="Markup">\end{code}</a><a id="7336" class="Background">
\caption{Three proofs that the counter doesn&#39;t stay constant}
\end{figure*}
</a></pre></body></html>