<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.PPUp</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Update Proposal Mechanism}

</a><a id="38" class="Markup">\begin{code}[hide]</a>
<a id="57" class="Symbol">{-#</a> <a id="61" class="Keyword">OPTIONS</a> <a id="69" class="Pragma">--safe</a> <a id="76" class="Symbol">#-}</a>

<a id="81" class="Keyword">open</a> <a id="86" class="Keyword">import</a> <a id="93" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="113" class="Keyword">module</a> <a id="120" href="Ledger.PPUp.html" class="Module">Ledger.PPUp</a> <a id="132" class="Symbol">(</a><a id="133" href="Ledger.PPUp.html#133" class="Bound">txs</a> <a id="137" class="Symbol">:</a> <a id="139" href="Ledger.Transaction.html#516" class="Record">TransactionStructure</a><a id="159" class="Symbol">)</a> <a id="161" class="Keyword">where</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a> <a id="194" class="Keyword">hiding</a> <a id="201" class="Symbol">(</a><a id="202" href="Data.Nat.Base.html#1894" class="Function Operator">_≥_</a><a id="205" class="Symbol">;</a> <a id="207" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">_+_</a><a id="210" class="Symbol">;</a> <a id="212" href="Agda.Builtin.Nat.html#522" class="Primitive Operator">_*_</a><a id="215" class="Symbol">)</a>

<a id="218" class="Keyword">open</a> <a id="223" href="Ledger.Transaction.html#516" class="Module">TransactionStructure</a> <a id="244" href="Ledger.PPUp.html#133" class="Bound">txs</a>

<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Algebra.html" class="Module">Algebra</a>

<a id="270" class="Keyword">import</a> <a id="277" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="286" class="Symbol">as</a> <a id="289" class="Module">ℕ</a>
<a id="291" class="Keyword">import</a> <a id="298" href="Data.Unit.Polymorphic.html" class="Module">Data.Unit.Polymorphic</a>
<a id="320" class="Keyword">open</a> <a id="325" href="Algebra.Bundles.html#16312" class="Module">Semiring</a> <a id="334" href="Ledger.Epoch.html#562" class="Function">Slotʳ</a>
<a id="340" class="Keyword">open</a> <a id="345" class="Keyword">import</a> <a id="352" href="Algebra.Literals.html" class="Module">Algebra.Literals</a>
<a id="369" class="Keyword">open</a> <a id="374" class="Keyword">import</a> <a id="381" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="401" class="Keyword">using</a> <a id="407" class="Symbol">(</a><a id="408" href="Data.Nat.Properties.html#16943" class="Function">m+1+n≢m</a><a id="415" class="Symbol">)</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.Product.Properties.html" class="Module">Data.Product.Properties</a>
<a id="453" class="Keyword">open</a> <a id="458" class="Keyword">import</a> <a id="465" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="480" href="Ledger.Epoch.html#593" class="Function">Epoch</a>

<a id="487" class="Keyword">open</a> <a id="492" class="Keyword">import</a> <a id="499" href="Agda.Builtin.FromNat.html" class="Module">Agda.Builtin.FromNat</a>
<a id="520" class="Keyword">open</a> <a id="525" class="Keyword">import</a> <a id="532" href="Data.Nat.Literals.html" class="Module">Data.Nat.Literals</a>
<a id="550" class="Keyword">import</a> <a id="557" href="Data.Unit.Polymorphic.html" class="Module">Data.Unit.Polymorphic</a>
<a id="579" class="Keyword">open</a> <a id="584" href="Algebra.Literals.html#203" class="Module">Semiring-Lit</a> <a id="597" href="Ledger.Epoch.html#562" class="Function">Slotʳ</a>

<a id="604" class="Keyword">private</a> <a id="612" class="Keyword">variable</a> <a id="621" href="Ledger.PPUp.html#621" class="Generalizable">m</a> <a id="623" href="Ledger.PPUp.html#623" class="Generalizable">n</a> <a id="625" class="Symbol">:</a> <a id="627" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>

<a id="630" class="Keyword">instance</a>
  <a id="641" href="Ledger.PPUp.html#641" class="Function">_</a> <a id="643" class="Symbol">=</a> <a id="645" href="Data.Nat.Literals.html#353" class="Function">Data.Nat.Literals.number</a>
  <a id="672" href="Ledger.PPUp.html#672" class="Function">_</a> <a id="674" class="Symbol">=</a> <a id="676" href="Data.Unit.Polymorphic.Base.html#524" class="Function">Data.Unit.Polymorphic.tt</a>

<a id="702" class="Markup">\end{code}</a><a id="712" class="Background">
\begin{figure*}[h]
</a><a id="732" class="Markup">\begin{code}</a>
<a id="GenesisDelegation"></a><a id="745" href="Ledger.PPUp.html#745" class="Function">GenesisDelegation</a> <a id="763" class="Symbol">=</a> <a id="765" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a> <a id="773" href="Ledger.Prelude.html#1835" class="Function Operator">↛</a> <a id="775" class="Symbol">(</a><a id="776" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a> <a id="784" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="786" href="Ledger.Crypto.html#1812" class="Function">KeyHash</a><a id="793" class="Symbol">)</a>

<a id="796" class="Keyword">record</a> <a id="PPUpdateState"></a><a id="803" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a> <a id="817" class="Symbol">:</a> <a id="819" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="823" class="Keyword">where</a>
  <a id="831" class="Keyword">field</a> <a id="PPUpdateState.pup"></a><a id="837" href="Ledger.PPUp.html#837" class="Field">pup</a>   <a id="843" class="Symbol">:</a> <a id="845" href="Ledger.Transaction.html#2910" class="Function">ProposedPPUpdates</a>
        <a id="PPUpdateState.fpup"></a><a id="871" href="Ledger.PPUp.html#871" class="Field">fpup</a>  <a id="877" class="Symbol">:</a> <a id="879" href="Ledger.Transaction.html#2910" class="Function">ProposedPPUpdates</a>

<a id="898" class="Keyword">record</a> <a id="PPUpdateEnv"></a><a id="905" href="Ledger.PPUp.html#905" class="Record">PPUpdateEnv</a> <a id="917" class="Symbol">:</a> <a id="919" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="923" class="Keyword">where</a>
  <a id="931" class="Keyword">field</a> <a id="PPUpdateEnv.slot"></a><a id="937" href="Ledger.PPUp.html#937" class="Field">slot</a>       <a id="948" class="Symbol">:</a> <a id="950" href="Ledger.Epoch.html#608" class="Function">Slot</a>
        <a id="PPUpdateEnv.pparams"></a><a id="963" href="Ledger.PPUp.html#963" class="Field">pparams</a>    <a id="974" class="Symbol">:</a> <a id="976" href="Ledger.PParams.html#211" class="Record">PParams</a>
        <a id="PPUpdateEnv.genDelegs"></a><a id="992" href="Ledger.PPUp.html#992" class="Field">genDelegs</a>  <a id="1003" class="Symbol">:</a> <a id="1005" href="Ledger.PPUp.html#745" class="Function">GenesisDelegation</a>
<a id="1023" class="Markup">\end{code}</a><a id="1033" class="Background">
\caption{PPUP types}
\end{figure*}
\begin{figure*}[h]
</a><a id="1088" class="Markup">\begin{code}</a>
<a id="1101" class="Keyword">data</a> <a id="pvCanFollow"></a><a id="1106" href="Ledger.PPUp.html#1106" class="Datatype">pvCanFollow</a> <a id="1118" class="Symbol">:</a> <a id="1120" href="Ledger.PParams.html#187" class="Function">ProtVer</a> <a id="1128" class="Symbol">→</a> <a id="1130" href="Ledger.PParams.html#187" class="Function">ProtVer</a> <a id="1138" class="Symbol">→</a> <a id="1140" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1144" class="Keyword">where</a>
  <a id="pvCanFollow.canFollowMajor"></a><a id="1152" href="Ledger.PPUp.html#1152" class="InductiveConstructor">canFollowMajor</a> <a id="1167" class="Symbol">:</a> <a id="1169" href="Ledger.PPUp.html#1106" class="Datatype">pvCanFollow</a> <a id="1181" class="Symbol">(</a><a id="1182" href="Ledger.PPUp.html#621" class="Generalizable">m</a> <a id="1184" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1186" href="Ledger.PPUp.html#623" class="Generalizable">n</a><a id="1187" class="Symbol">)</a> <a id="1189" class="Symbol">(</a><a id="1190" href="Ledger.PPUp.html#621" class="Generalizable">m</a> <a id="1192" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">ℕ.+</a> <a id="1196" class="Number">1</a> <a id="1198" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1200" class="Number">0</a><a id="1201" class="Symbol">)</a>
  <a id="pvCanFollow.canFollowMinor"></a><a id="1205" href="Ledger.PPUp.html#1205" class="InductiveConstructor">canFollowMinor</a> <a id="1220" class="Symbol">:</a> <a id="1222" href="Ledger.PPUp.html#1106" class="Datatype">pvCanFollow</a> <a id="1234" class="Symbol">(</a><a id="1235" href="Ledger.PPUp.html#621" class="Generalizable">m</a> <a id="1237" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1239" href="Ledger.PPUp.html#623" class="Generalizable">n</a><a id="1240" class="Symbol">)</a> <a id="1242" class="Symbol">(</a><a id="1243" href="Ledger.PPUp.html#621" class="Generalizable">m</a> <a id="1245" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1247" href="Ledger.PPUp.html#623" class="Generalizable">n</a> <a id="1249" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">ℕ.+</a> <a id="1253" class="Number">1</a><a id="1254" class="Symbol">)</a>

<a id="viablePParams"></a><a id="1257" href="Ledger.PPUp.html#1257" class="Function">viablePParams</a> <a id="1271" class="Symbol">:</a> <a id="1273" href="Ledger.PParams.html#211" class="Record">PParams</a> <a id="1281" class="Symbol">→</a> <a id="1283" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1287" href="Ledger.PPUp.html#1257" class="Function">viablePParams</a> <a id="1301" href="Ledger.PPUp.html#1301" class="Bound">pp</a> <a id="1304" class="Symbol">=</a> <a id="1306" href="Agda.Builtin.Unit.html#158" class="Record">⊤</a> <a id="1308" class="Comment">-- TODO: block size check</a>

<a id="isViableUpdate"></a><a id="1335" href="Ledger.PPUp.html#1335" class="Function">isViableUpdate</a> <a id="1350" class="Symbol">:</a> <a id="1352" href="Ledger.PParams.html#211" class="Record">PParams</a> <a id="1360" class="Symbol">→</a> <a id="1362" href="Ledger.Transaction.html#2648" class="Function">PParamsUpdate</a> <a id="1376" class="Symbol">→</a> <a id="1378" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1382" href="Ledger.PPUp.html#1335" class="Function">isViableUpdate</a> <a id="1397" href="Ledger.PPUp.html#1397" class="Bound">pp</a> <a id="1400" href="Ledger.PPUp.html#1400" class="Bound">pup</a> <a id="1404" class="Keyword">with</a> <a id="1409" href="Ledger.PParams.html#699" class="Function">applyUpdate</a> <a id="1421" href="Ledger.PPUp.html#1397" class="Bound">pp</a> <a id="1424" href="Ledger.PPUp.html#1400" class="Bound">pup</a>
<a id="1428" class="Symbol">...</a> <a id="1432" class="Symbol">|</a> <a id="1434" href="Ledger.PPUp.html#1434" class="Bound">pp&#39;</a> <a id="1438" class="Symbol">=</a> <a id="1440" href="Ledger.PPUp.html#1106" class="Datatype">pvCanFollow</a> <a id="1452" class="Symbol">(</a><a id="1453" href="Ledger.PParams.html#492" class="Field">PParams.pv</a> <a id="1464" class="Bound">pp</a><a id="1466" class="Symbol">)</a> <a id="1468" class="Symbol">(</a><a id="1469" href="Ledger.PParams.html#492" class="Field">PParams.pv</a> <a id="1480" href="Ledger.PPUp.html#1434" class="Bound">pp&#39;</a><a id="1483" class="Symbol">)</a> <a id="1485" href="Data.Product.Base.html#1109" class="Function Operator">×</a> <a id="1487" href="Ledger.PPUp.html#1257" class="Function">viablePParams</a> <a id="1501" href="Ledger.PPUp.html#1434" class="Bound">pp&#39;</a>
<a id="1505" class="Markup">\end{code}</a><a id="1515" class="Background">
\caption{Definitions for PPUP}
\end{figure*}
</a><a id="1561" class="Markup">\begin{code}[hide]</a>
<a id="1580" class="Keyword">private</a> <a id="1588" class="Keyword">variable</a>
  <a id="1599" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="1601" class="Symbol">:</a> <a id="1603" href="Ledger.PPUp.html#905" class="Record">PPUpdateEnv</a>
  <a id="1617" href="Ledger.PPUp.html#1617" class="Generalizable">s</a> <a id="1619" class="Symbol">:</a> <a id="1621" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a>
  <a id="1637" href="Ledger.PPUp.html#1637" class="Generalizable">e</a> <a id="1639" class="Symbol">:</a> <a id="1641" href="Ledger.Epoch.html#593" class="Function">Epoch</a>
  <a id="1649" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="1653" href="Ledger.PPUp.html#1653" class="Generalizable">pupˢ</a> <a id="1658" href="Ledger.PPUp.html#1658" class="Generalizable">fpupˢ</a> <a id="1664" class="Symbol">:</a> <a id="1666" href="Ledger.Transaction.html#2910" class="Function">ProposedPPUpdates</a>

<a id="viablePParams?"></a><a id="1685" href="Ledger.PPUp.html#1685" class="Function">viablePParams?</a> <a id="1700" class="Symbol">:</a> <a id="1702" href="Relation.Unary.html#3685" class="Function">Dec₁</a> <a id="1707" href="Ledger.PPUp.html#1257" class="Function">viablePParams</a>
<a id="1721" href="Ledger.PPUp.html#1685" class="Function">viablePParams?</a> <a id="1736" href="Ledger.PPUp.html#1736" class="Bound">pp</a> <a id="1739" class="Symbol">=</a> <a id="1741" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="1745" class="Symbol">_</a>

<a id="pvCanFollow?"></a><a id="1748" href="Ledger.PPUp.html#1748" class="Function">pvCanFollow?</a> <a id="1761" class="Symbol">:</a> <a id="1763" class="Symbol">∀</a> <a id="1765" href="Ledger.PPUp.html#1765" class="Bound">pv</a> <a id="1768" href="Ledger.PPUp.html#1768" class="Bound">pv&#39;</a> <a id="1772" class="Symbol">→</a> <a id="1774" href="Relation.Nullary.Decidable.Core.html#1476" class="Record">Dec</a> <a id="1778" class="Symbol">(</a><a id="1779" href="Ledger.PPUp.html#1106" class="Datatype">pvCanFollow</a> <a id="1791" href="Ledger.PPUp.html#1765" class="Bound">pv</a> <a id="1794" href="Ledger.PPUp.html#1768" class="Bound">pv&#39;</a><a id="1797" class="Symbol">)</a>
<a id="1799" href="Ledger.PPUp.html#1748" class="Function">pvCanFollow?</a> <a id="1812" class="Symbol">(</a><a id="1813" href="Ledger.PPUp.html#1813" class="Bound">m</a> <a id="1815" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1817" href="Ledger.PPUp.html#1817" class="Bound">n</a><a id="1818" class="Symbol">)</a> <a id="1820" href="Ledger.PPUp.html#1820" class="Bound">pv</a> <a id="1823" class="Keyword">with</a> <a id="1828" href="Ledger.PPUp.html#1820" class="Bound">pv</a> <a id="1831" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="1833" class="Symbol">(</a><a id="1834" href="Ledger.PPUp.html#1813" class="Bound">m</a> <a id="1836" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">ℕ.+</a> <a id="1840" class="Number">1</a> <a id="1842" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1844" class="Number">0</a><a id="1845" class="Symbol">)</a> <a id="1847" class="Symbol">|</a> <a id="1849" href="Ledger.PPUp.html#1820" class="Bound">pv</a> <a id="1852" href="Interface.DecEq.html#243" class="Field Operator">≟</a> <a id="1854" class="Symbol">(</a><a id="1855" href="Ledger.PPUp.html#1813" class="Bound">m</a> <a id="1857" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1859" href="Ledger.PPUp.html#1817" class="Bound">n</a> <a id="1861" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">ℕ.+</a> <a id="1865" class="Number">1</a><a id="1866" class="Symbol">)</a>
<a id="1868" class="Symbol">...</a> <a id="1872" class="Symbol">|</a> <a id="1874" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="1877" href="Ledger.PPUp.html#1877" class="Bound">¬p</a> <a id="1880" class="Symbol">|</a> <a id="1882" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="1885" href="Ledger.PPUp.html#1885" class="Bound">¬p₁</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="1894" class="Symbol">(λ</a> <a id="1897" class="Symbol">{</a> <a id="1899" href="Ledger.PPUp.html#1152" class="InductiveConstructor">canFollowMajor</a> <a id="1914" class="Symbol">→</a> <a id="1916" href="Ledger.PPUp.html#1877" class="Bound">¬p</a> <a id="1919" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">_≡_.refl</a> <a id="1928" class="Symbol">;</a> <a id="1930" href="Ledger.PPUp.html#1205" class="InductiveConstructor">canFollowMinor</a> <a id="1945" class="Symbol">→</a> <a id="1947" href="Ledger.PPUp.html#1885" class="Bound">¬p₁</a> <a id="1951" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">_≡_.refl</a> <a id="1960" class="Symbol">})</a>
<a id="1963" class="Symbol">...</a> <a id="1967" class="Symbol">|</a> <a id="1969" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="1972" href="Ledger.PPUp.html#1972" class="Bound">¬p</a> <a id="1975" class="Symbol">|</a> <a id="1977" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="1981" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="1986" class="Symbol">=</a> <a id="1988" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="1992" href="Ledger.PPUp.html#1205" class="InductiveConstructor">canFollowMinor</a>
<a id="2007" class="Symbol">...</a> <a id="2011" class="Symbol">|</a> <a id="2013" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="2017" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="2022" class="Symbol">|</a> <a id="2024" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a> <a id="2027" href="Ledger.PPUp.html#2027" class="Bound">¬p</a> <a id="2030" class="Symbol">=</a> <a id="2032" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="2036" href="Ledger.PPUp.html#1152" class="InductiveConstructor">canFollowMajor</a>
<a id="2051" class="Symbol">...</a> <a id="2055" class="Symbol">|</a> <a id="2057" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="2061" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="2066" class="Symbol">|</a> <a id="2068" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="2072" href="Ledger.PPUp.html#2072" class="Bound">p</a> <a id="2074" class="Symbol">=</a> <a id="2076" href="Data.Empty.html#1041" class="Function">⊥-elim</a> <a id="2083" class="Symbol">(</a><a id="2084" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="2089" href="Data.Product.Base.html#608" class="Field">proj₁</a> <a id="2095" class="Symbol">(</a><a id="2096" href="Data.Product.Properties.html#3163" class="Function">×-≡,≡←≡</a> <a id="2104" href="Ledger.PPUp.html#2072" class="Bound">p</a><a id="2105" class="Symbol">)</a> <a id="2107" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="2110" href="Data.Nat.Properties.html#16943" class="Function">m+1+n≢m</a> <a id="2118" class="Bound">m</a><a id="2119" class="Symbol">)</a>

<a id="isViableUpdate?"></a><a id="2122" href="Ledger.PPUp.html#2122" class="Function">isViableUpdate?</a> <a id="2138" class="Symbol">:</a> <a id="2140" class="Symbol">∀</a> <a id="2142" href="Ledger.PPUp.html#2142" class="Bound">pparams</a> <a id="2150" class="Symbol">→</a> <a id="2152" href="Relation.Unary.html#3685" class="Function">Dec₁</a> <a id="2157" class="Symbol">(</a><a id="2158" href="Ledger.PPUp.html#1335" class="Function">isViableUpdate</a> <a id="2173" href="Ledger.PPUp.html#2142" class="Bound">pparams</a><a id="2180" class="Symbol">)</a>
<a id="2182" href="Ledger.PPUp.html#2122" class="Function">isViableUpdate?</a> <a id="2198" href="Ledger.PPUp.html#2198" class="Bound">pp</a> <a id="2201" href="Ledger.PPUp.html#2201" class="Bound">pup</a> <a id="2205" class="Keyword">with</a> <a id="2210" href="Ledger.PParams.html#699" class="Function">applyUpdate</a> <a id="2222" href="Ledger.PPUp.html#2198" class="Bound">pp</a> <a id="2225" href="Ledger.PPUp.html#2201" class="Bound">pup</a>
<a id="2229" class="Symbol">...</a> <a id="2233" class="Symbol">|</a> <a id="2235" href="Ledger.PPUp.html#2235" class="Bound">pp&#39;</a> <a id="2239" class="Symbol">=</a> <a id="2241" href="Ledger.PPUp.html#1748" class="Function">pvCanFollow?</a> <a id="2254" class="Symbol">(</a><a id="2255" href="Ledger.PParams.html#492" class="Field">PParams.pv</a> <a id="2266" class="Bound">pp</a><a id="2268" class="Symbol">)</a> <a id="2270" class="Symbol">(</a><a id="2271" href="Ledger.PParams.html#492" class="Field">PParams.pv</a> <a id="2282" href="Ledger.PPUp.html#2235" class="Bound">pp&#39;</a><a id="2285" class="Symbol">)</a> <a id="2287" href="Relation.Nullary.Decidable.Core.html#2255" class="Function Operator">×-dec</a> <a id="2293" href="Ledger.PPUp.html#1685" class="Function">viablePParams?</a> <a id="2308" href="Ledger.PPUp.html#2235" class="Bound">pp&#39;</a>

<a id="2313" class="Keyword">data</a> <a id="_⊢_⇀⦇_,PPUP⦈_"></a><a id="2318" href="Ledger.PPUp.html#2318" class="Datatype Operator">_⊢_⇀⦇_,PPUP⦈_</a> <a id="2332" class="Symbol">:</a> <a id="2334" href="Ledger.PPUp.html#905" class="Record">PPUpdateEnv</a> <a id="2346" class="Symbol">→</a> <a id="2348" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a> <a id="2362" class="Symbol">→</a> <a id="2364" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="2370" href="Ledger.Transaction.html#2956" class="Function">Update</a> <a id="2377" class="Symbol">→</a> <a id="2379" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a> <a id="2393" class="Symbol">→</a> <a id="2395" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="2399" class="Keyword">where</a>
<a id="2405" class="Markup">\end{code}</a><a id="2415" class="Background">
\begin{figure*}[h]
</a><a id="2435" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,PPUP⦈_.PPUpdateEmpty"></a><a id="2450" href="Ledger.PPUp.html#2450" class="InductiveConstructor">PPUpdateEmpty</a> <a id="2464" class="Symbol">:</a> <a id="2466" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="2468" href="Ledger.PPUp.html#2318" class="Datatype Operator">⊢</a> <a id="2470" href="Ledger.PPUp.html#1617" class="Generalizable">s</a> <a id="2472" href="Ledger.PPUp.html#2318" class="Datatype Operator">⇀⦇</a> <a id="2475" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="2483" href="Ledger.PPUp.html#2318" class="Datatype Operator">,PPUP⦈</a> <a id="2490" href="Ledger.PPUp.html#1617" class="Generalizable">s</a>

  <a id="_⊢_⇀⦇_,PPUP⦈_.PPUpdateCurrent"></a><a id="2495" href="Ledger.PPUp.html#2495" class="InductiveConstructor">PPUpdateCurrent</a> <a id="2511" class="Symbol">:</a> <a id="2513" class="Keyword">let</a> <a id="2517" class="Keyword">open</a> <a id="2522" href="Ledger.PPUp.html#905" class="Module">PPUpdateEnv</a> <a id="2534" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="2536" class="Keyword">in</a>
    <a id="2543" href="Axiom.Set.Rel.html#1257" class="Function">dom</a> <a id="2547" class="Symbol">(</a><a id="2548" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="2552" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="2553" class="Symbol">)</a> <a id="2555" href="Axiom.Set.html#1579" class="Function Operator">⊆</a> <a id="2557" href="Axiom.Set.Rel.html#1257" class="Function">dom</a> <a id="2561" class="Symbol">(</a><a id="2562" href="Ledger.PPUp.html#992" class="Function">genDelegs</a> <a id="2572" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="2573" class="Symbol">)</a>
    <a id="2579" class="Symbol">→</a> <a id="2581" href="Axiom.Set.html#5743" class="Function">All</a> <a id="2585" class="Symbol">(</a><a id="2586" href="Ledger.PPUp.html#1335" class="Function">isViableUpdate</a> <a id="2601" href="Ledger.PPUp.html#963" class="Function">pparams</a><a id="2608" class="Symbol">)</a> <a id="2610" class="Symbol">(</a><a id="2611" href="Axiom.Set.Rel.html#1296" class="Function">range</a> <a id="2617" class="Symbol">(</a><a id="2618" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="2622" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="2623" class="Symbol">))</a>
    <a id="2630" class="Symbol">→</a> <a id="2632" class="Symbol">(</a><a id="2633" href="Ledger.PPUp.html#937" class="Function">slot</a> <a id="2638" href="Algebra.Bundles.html#16462" class="Function Operator">+</a> <a id="2640" class="Symbol">(</a><a id="2641" class="Number">2</a> <a id="2643" href="Algebra.Bundles.html#16491" class="Function Operator">*</a> <a id="2645" href="Ledger.Epoch.html#789" class="Function">StabilityWindow</a><a id="2660" class="Symbol">))</a> <a id="2663" href="Ledger.Epoch.html#709" class="Function Operator">&lt;ˢ</a> <a id="2666" href="Ledger.Epoch.html#676" class="Function">firstSlot</a> <a id="2676" class="Symbol">(</a><a id="2677" href="Ledger.Epoch.html#820" class="Function">sucᵉ</a> <a id="2682" class="Symbol">(</a><a id="2683" href="Ledger.Epoch.html#647" class="Function">epoch</a> <a id="2689" href="Ledger.PPUp.html#937" class="Function">slot</a><a id="2693" class="Symbol">))</a>
    <a id="2700" class="Symbol">→</a> <a id="2702" href="Ledger.Epoch.html#647" class="Function">epoch</a> <a id="2708" href="Ledger.PPUp.html#937" class="Function">slot</a> <a id="2713" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="2715" href="Ledger.PPUp.html#1637" class="Generalizable">e</a>
    <a id="2721" href="Interface.ComputationalRelation.html#276" class="Function Operator">────────────────────────────────</a>
    <a id="2758" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="2760" href="Ledger.PPUp.html#2318" class="Datatype Operator">⊢</a> <a id="2762" class="Keyword">record</a> <a id="2769" class="Symbol">{</a> <a id="2771" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="2775" class="Symbol">=</a> <a id="2777" href="Ledger.PPUp.html#1653" class="Generalizable">pupˢ</a> <a id="2782" class="Symbol">;</a> <a id="2784" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="2789" class="Symbol">=</a> <a id="2791" href="Ledger.PPUp.html#1658" class="Generalizable">fpupˢ</a> <a id="2797" class="Symbol">}</a> <a id="2799" href="Ledger.PPUp.html#2318" class="Datatype Operator">⇀⦇</a> <a id="2802" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="2807" class="Symbol">(</a><a id="2808" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="2812" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2814" href="Ledger.PPUp.html#1637" class="Generalizable">e</a><a id="2815" class="Symbol">)</a> <a id="2817" href="Ledger.PPUp.html#2318" class="Datatype Operator">,PPUP⦈</a>
        <a id="2832" class="Keyword">record</a> <a id="2839" class="Symbol">{</a> <a id="2841" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="2845" class="Symbol">=</a> <a id="2847" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="2851" href="Axiom.Set.Map.html#3788" class="Function Operator">∪ᵐˡ</a> <a id="2855" href="Ledger.PPUp.html#1653" class="Generalizable">pupˢ</a> <a id="2860" class="Symbol">;</a> <a id="2862" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="2867" class="Symbol">=</a> <a id="2869" href="Ledger.PPUp.html#1658" class="Generalizable">fpupˢ</a> <a id="2875" class="Symbol">}</a>

  <a id="_⊢_⇀⦇_,PPUP⦈_.PPUpdateFuture"></a><a id="2880" href="Ledger.PPUp.html#2880" class="InductiveConstructor">PPUpdateFuture</a> <a id="2895" class="Symbol">:</a> <a id="2897" class="Keyword">let</a> <a id="2901" class="Keyword">open</a> <a id="2906" href="Ledger.PPUp.html#905" class="Module">PPUpdateEnv</a> <a id="2918" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="2920" class="Keyword">in</a>
    <a id="2927" href="Axiom.Set.Rel.html#1257" class="Function">dom</a> <a id="2931" class="Symbol">(</a><a id="2932" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="2936" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="2937" class="Symbol">)</a> <a id="2939" href="Axiom.Set.html#1579" class="Function Operator">⊆</a> <a id="2941" href="Axiom.Set.Rel.html#1257" class="Function">dom</a> <a id="2945" class="Symbol">(</a><a id="2946" href="Ledger.PPUp.html#992" class="Function">genDelegs</a> <a id="2956" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="2957" class="Symbol">)</a>
    <a id="2963" class="Symbol">→</a> <a id="2965" href="Axiom.Set.html#5743" class="Function">All</a> <a id="2969" class="Symbol">(</a><a id="2970" href="Ledger.PPUp.html#1335" class="Function">isViableUpdate</a> <a id="2985" href="Ledger.PPUp.html#963" class="Function">pparams</a><a id="2992" class="Symbol">)</a> <a id="2994" class="Symbol">(</a><a id="2995" href="Axiom.Set.Rel.html#1296" class="Function">range</a> <a id="3001" class="Symbol">(</a><a id="3002" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="3006" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="3007" class="Symbol">))</a>
    <a id="3014" class="Symbol">→</a> <a id="3016" class="Symbol">(</a><a id="3017" href="Ledger.PPUp.html#937" class="Function">slot</a> <a id="3022" href="Algebra.Bundles.html#16462" class="Function Operator">+</a> <a id="3024" class="Symbol">(</a><a id="3025" class="Number">2</a> <a id="3027" href="Algebra.Bundles.html#16491" class="Function Operator">*</a> <a id="3029" href="Ledger.Epoch.html#789" class="Function">StabilityWindow</a><a id="3044" class="Symbol">))</a> <a id="3047" href="Ledger.Epoch.html#844" class="Function Operator">≥ˢ</a> <a id="3050" href="Ledger.Epoch.html#676" class="Function">firstSlot</a> <a id="3060" class="Symbol">(</a><a id="3061" href="Ledger.Epoch.html#820" class="Function">sucᵉ</a> <a id="3066" class="Symbol">(</a><a id="3067" href="Ledger.Epoch.html#647" class="Function">epoch</a> <a id="3073" href="Ledger.PPUp.html#937" class="Function">slot</a><a id="3077" class="Symbol">))</a>
    <a id="3084" class="Symbol">→</a> <a id="3086" href="Ledger.Epoch.html#820" class="Function">sucᵉ</a> <a id="3091" class="Symbol">(</a><a id="3092" href="Ledger.Epoch.html#647" class="Function">epoch</a> <a id="3098" href="Ledger.PPUp.html#937" class="Function">slot</a><a id="3102" class="Symbol">)</a> <a id="3104" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="3106" href="Ledger.PPUp.html#1637" class="Generalizable">e</a>
    <a id="3112" href="Interface.ComputationalRelation.html#276" class="Function Operator">────────────────────────────────</a>
    <a id="3149" href="Ledger.PPUp.html#1599" class="Generalizable">Γ</a> <a id="3151" href="Ledger.PPUp.html#2318" class="Datatype Operator">⊢</a> <a id="3153" class="Keyword">record</a> <a id="3160" class="Symbol">{</a> <a id="3162" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="3166" class="Symbol">=</a> <a id="3168" href="Ledger.PPUp.html#1653" class="Generalizable">pupˢ</a> <a id="3173" class="Symbol">;</a> <a id="3175" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="3180" class="Symbol">=</a> <a id="3182" href="Ledger.PPUp.html#1658" class="Generalizable">fpupˢ</a> <a id="3188" class="Symbol">}</a> <a id="3190" href="Ledger.PPUp.html#2318" class="Datatype Operator">⇀⦇</a> <a id="3193" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="3198" class="Symbol">(</a><a id="3199" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="3203" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3205" href="Ledger.PPUp.html#1637" class="Generalizable">e</a><a id="3206" class="Symbol">)</a> <a id="3208" href="Ledger.PPUp.html#2318" class="Datatype Operator">,PPUP⦈</a>
        <a id="3223" class="Keyword">record</a> <a id="3230" class="Symbol">{</a> <a id="3232" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="3236" class="Symbol">=</a> <a id="3238" href="Ledger.PPUp.html#1653" class="Generalizable">pupˢ</a> <a id="3243" class="Symbol">;</a> <a id="3245" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="3250" class="Symbol">=</a> <a id="3252" href="Ledger.PPUp.html#1649" class="Generalizable">pup</a> <a id="3256" href="Axiom.Set.Map.html#3788" class="Function Operator">∪ᵐˡ</a> <a id="3260" href="Ledger.PPUp.html#1658" class="Generalizable">fpupˢ</a> <a id="3266" class="Symbol">}</a>
<a id="3268" class="Markup">\end{code}</a><a id="3278" class="Background">
\caption{PPUP inference rules}
\end{figure*}
</a></pre></body></html>