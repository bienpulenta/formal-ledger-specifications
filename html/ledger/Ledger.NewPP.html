<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Ledger.NewPP</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Background">\section{Protocol Parameters Update}

</a><a id="39" class="Markup">\begin{code}[hide]</a>
<a id="58" class="Symbol">{-#</a> <a id="62" class="Keyword">OPTIONS</a> <a id="70" class="Pragma">--safe</a> <a id="77" class="Symbol">#-}</a>

<a id="82" class="Keyword">open</a> <a id="87" class="Keyword">import</a> <a id="94" href="Ledger.Transaction.html" class="Module">Ledger.Transaction</a>

<a id="114" class="Keyword">module</a> <a id="121" href="Ledger.NewPP.html" class="Module">Ledger.NewPP</a> <a id="134" class="Symbol">(</a><a id="135" href="Ledger.NewPP.html#135" class="Bound">txs</a> <a id="139" class="Symbol">:</a> <a id="141" href="Ledger.Transaction.html#516" class="Record">TransactionStructure</a><a id="161" class="Symbol">)</a> <a id="163" class="Keyword">where</a>

<a id="170" class="Keyword">open</a> <a id="175" class="Keyword">import</a> <a id="182" href="Ledger.Prelude.html" class="Module">Ledger.Prelude</a>

<a id="198" class="Keyword">open</a> <a id="203" href="Ledger.Transaction.html#516" class="Module">TransactionStructure</a> <a id="224" href="Ledger.NewPP.html#135" class="Bound">txs</a>
<a id="228" class="Keyword">open</a> <a id="233" class="Keyword">import</a> <a id="240" href="Ledger.PParams.html" class="Module">Ledger.PParams</a> <a id="255" href="Ledger.Epoch.html#593" class="Function">Epoch</a>
<a id="261" class="Keyword">open</a> <a id="266" class="Keyword">import</a> <a id="273" href="Ledger.PPUp.html" class="Module">Ledger.PPUp</a> <a id="285" href="Ledger.NewPP.html#135" class="Bound">txs</a>

<a id="290" class="Keyword">open</a> <a id="295" class="Keyword">import</a> <a id="302" href="Relation.Nullary.Decidable.html" class="Module">Relation.Nullary.Decidable</a>

<a id="330" class="Keyword">record</a> <a id="NewPParamEnv"></a><a id="337" href="Ledger.NewPP.html#337" class="Record">NewPParamEnv</a> <a id="350" class="Symbol">:</a> <a id="352" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="356" class="Keyword">where</a>
<a id="362" class="Comment">--  field</a>
<a id="372" class="Markup">\end{code}</a><a id="382" class="Background">
\begin{figure*}[h]
</a><a id="402" class="Markup">\begin{code}</a>
<a id="415" class="Keyword">record</a> <a id="NewPParamState"></a><a id="422" href="Ledger.NewPP.html#422" class="Record">NewPParamState</a> <a id="437" class="Symbol">:</a> <a id="439" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="443" class="Keyword">where</a>
  <a id="451" class="Keyword">constructor</a> <a id="⟦_,_⟧ⁿᵖ"></a><a id="463" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">⟦_,_⟧ⁿᵖ</a>
  <a id="473" class="Keyword">field</a> <a id="NewPParamState.pparams"></a><a id="479" href="Ledger.NewPP.html#479" class="Field">pparams</a>  <a id="488" class="Symbol">:</a> <a id="490" href="Ledger.PParams.html#211" class="Record">PParams</a>
        <a id="NewPParamState.ppup"></a><a id="506" href="Ledger.NewPP.html#506" class="Field">ppup</a>     <a id="515" class="Symbol">:</a> <a id="517" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a>

<a id="updatePPUp"></a><a id="532" href="Ledger.NewPP.html#532" class="Function">updatePPUp</a> <a id="543" class="Symbol">:</a> <a id="545" href="Ledger.PParams.html#211" class="Record">PParams</a> <a id="553" class="Symbol">→</a> <a id="555" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a> <a id="569" class="Symbol">→</a> <a id="571" href="Ledger.PPUp.html#803" class="Record">PPUpdateState</a>
<a id="585" href="Ledger.NewPP.html#532" class="Function">updatePPUp</a> <a id="596" href="Ledger.NewPP.html#596" class="Bound">pparams</a> <a id="604" class="Keyword">record</a> <a id="611" class="Symbol">{</a> <a id="613" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="618" class="Symbol">=</a> <a id="620" href="Ledger.NewPP.html#620" class="Bound">fpup</a> <a id="625" class="Symbol">}</a> <a id="627" class="Keyword">with</a> <a id="632" href="Axiom.Set.html#6757" class="Function">allᵇ</a> <a id="637" class="Symbol">(</a><a id="638" href="Ledger.PPUp.html#2122" class="Function">isViableUpdate?</a> <a id="654" href="Ledger.NewPP.html#596" class="Bound">pparams</a><a id="661" class="Symbol">)</a> <a id="663" class="Symbol">(</a><a id="664" href="Axiom.Set.Rel.html#1296" class="Function">range</a> <a id="670" class="Symbol">(</a><a id="671" href="Ledger.NewPP.html#620" class="Bound">fpup</a> <a id="676" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="677" class="Symbol">))</a>
<a id="680" class="Symbol">...</a> <a id="684" class="Symbol">|</a> <a id="686" href="Agda.Builtin.Bool.html#175" class="InductiveConstructor">false</a>  <a id="693" class="Symbol">=</a> <a id="695" class="Keyword">record</a> <a id="702" class="Symbol">{</a> <a id="704" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="708" class="Symbol">=</a> <a id="710" href="Axiom.Set.Map.html#2064" class="Function">∅ᵐ</a>    <a id="716" class="Symbol">;</a> <a id="718" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="723" class="Symbol">=</a> <a id="725" href="Axiom.Set.Map.html#2064" class="Function">∅ᵐ</a> <a id="728" class="Symbol">}</a>
<a id="730" class="Symbol">...</a> <a id="734" class="Symbol">|</a> <a id="736" href="Agda.Builtin.Bool.html#181" class="InductiveConstructor">true</a>   <a id="743" class="Symbol">=</a> <a id="745" class="Keyword">record</a> <a id="752" class="Symbol">{</a> <a id="754" href="Ledger.PPUp.html#837" class="Field">pup</a> <a id="758" class="Symbol">=</a> <a id="760" class="Bound">fpup</a>  <a id="766" class="Symbol">;</a> <a id="768" href="Ledger.PPUp.html#871" class="Field">fpup</a> <a id="773" class="Symbol">=</a> <a id="775" href="Axiom.Set.Map.html#2064" class="Function">∅ᵐ</a> <a id="778" class="Symbol">}</a>

<a id="votedValue"></a><a id="781" href="Ledger.NewPP.html#781" class="Function">votedValue</a> <a id="792" class="Symbol">:</a> <a id="794" href="Ledger.Transaction.html#2910" class="Function">ProposedPPUpdates</a> <a id="812" class="Symbol">→</a> <a id="814" href="Ledger.PParams.html#211" class="Record">PParams</a> <a id="822" class="Symbol">→</a> <a id="824" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="826" class="Symbol">→</a> <a id="828" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="834" href="Ledger.Transaction.html#2648" class="Function">PParamsUpdate</a>
<a id="848" href="Ledger.NewPP.html#781" class="Function">votedValue</a> <a id="859" href="Ledger.NewPP.html#859" class="Bound">pup</a> <a id="863" href="Ledger.NewPP.html#863" class="Bound">pparams</a> <a id="871" href="Ledger.NewPP.html#871" class="Bound">quorum</a> <a id="878" class="Symbol">=</a>
  <a id="882" href="Function.Base.html#4053" class="Function Operator">case</a> <a id="887" href="Axiom.Set.html#6613" class="Function">any?</a> <a id="892" class="Symbol">(λ</a> <a id="895" href="Ledger.NewPP.html#895" class="Bound">u</a> <a id="897" class="Symbol">→</a> <a id="899" href="Ledger.Prelude.html#1453" class="Function">lengthˢ</a> <a id="907" class="Symbol">((</a><a id="909" href="Ledger.NewPP.html#859" class="Bound">pup</a> <a id="913" href="Axiom.Set.Map.html#5113" class="Function Operator">∣^</a> <a id="916" href="Axiom.Set.html#4214" class="Function">fromList</a> <a id="925" href="Data.List.Base.html#5219" class="Function Operator">[</a> <a id="927" href="Ledger.NewPP.html#895" class="Bound">u</a> <a id="929" href="Data.List.Base.html#5219" class="Function Operator">]</a><a id="930" class="Symbol">)</a> <a id="932" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="933" class="Symbol">)</a> <a id="935" href="Data.Nat.Properties.html#5938" class="Function Operator">≥?</a> <a id="938" href="Ledger.NewPP.html#871" class="Bound">quorum</a><a id="944" class="Symbol">)</a> <a id="946" class="Symbol">(</a><a id="947" href="Axiom.Set.Rel.html#1296" class="Function">range</a> <a id="953" class="Symbol">(</a><a id="954" href="Ledger.NewPP.html#859" class="Bound">pup</a> <a id="958" href="Axiom.Set.Map.html#1686" class="Function Operator">ˢ</a><a id="959" class="Symbol">))</a> <a id="962" href="Function.Base.html#4053" class="Function Operator">of</a> <a id="965" class="Symbol">λ</a> <a id="967" class="Keyword">where</a>
    <a id="977" class="Symbol">(</a><a id="978" href="Relation.Nullary.Decidable.Core.html#1650" class="InductiveConstructor">no</a>  <a id="982" class="Symbol">_)</a>        <a id="992" class="Symbol">→</a> <a id="994" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a>
    <a id="1006" class="Symbol">(</a><a id="1007" href="Relation.Nullary.Decidable.Core.html#1613" class="InductiveConstructor">yes</a> <a id="1011" class="Symbol">(</a><a id="1012" href="Ledger.NewPP.html#1012" class="Bound">u</a> <a id="1014" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1016" class="Symbol">_))</a>  <a id="1021" class="Symbol">→</a> <a id="1023" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1028" href="Ledger.NewPP.html#1012" class="Bound">u</a>
<a id="1030" class="Markup">\end{code}</a><a id="1040" class="Background">
\caption{Types and functions for the NEWPP transition system}
\end{figure*}
</a><a id="1117" class="Markup">\begin{code}[hide]</a>
<a id="1136" class="Keyword">private</a> <a id="1144" class="Keyword">variable</a>
  <a id="1155" href="Ledger.NewPP.html#1155" class="Generalizable">Γ</a> <a id="1157" class="Symbol">:</a> <a id="1159" href="Ledger.NewPP.html#337" class="Record">NewPParamEnv</a>
  <a id="1174" href="Ledger.NewPP.html#1174" class="Generalizable">s</a> <a id="1176" href="Ledger.NewPP.html#1176" class="Generalizable">s&#39;</a> <a id="1179" class="Symbol">:</a> <a id="1181" href="Ledger.NewPP.html#422" class="Record">NewPParamState</a>
  <a id="1198" href="Ledger.NewPP.html#1198" class="Generalizable">newpp</a> <a id="1204" class="Symbol">:</a> <a id="1206" href="Ledger.PParams.html#211" class="Record">PParams</a>
  <a id="1216" href="Ledger.NewPP.html#1216" class="Generalizable">upd</a> <a id="1220" class="Symbol">:</a> <a id="1222" href="Ledger.Transaction.html#2648" class="Function">PParamsUpdate</a>

<a id="1237" class="Keyword">data</a> <a id="_⊢_⇀⦇_,NEWPP⦈_"></a><a id="1242" href="Ledger.NewPP.html#1242" class="Datatype Operator">_⊢_⇀⦇_,NEWPP⦈_</a> <a id="1257" class="Symbol">:</a> <a id="1259" href="Ledger.NewPP.html#337" class="Record">NewPParamEnv</a> <a id="1272" class="Symbol">→</a> <a id="1274" href="Ledger.NewPP.html#422" class="Record">NewPParamState</a> <a id="1289" class="Symbol">→</a> <a id="1291" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1297" href="Ledger.Transaction.html#2648" class="Function">PParamsUpdate</a> <a id="1311" class="Symbol">→</a> <a id="1313" href="Ledger.NewPP.html#422" class="Record">NewPParamState</a> <a id="1328" class="Symbol">→</a> <a id="1330" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1334" class="Keyword">where</a>
<a id="1340" class="Markup">\end{code}</a><a id="1350" class="Background">
\begin{figure*}[h]
</a><a id="1370" class="Markup">\begin{code}</a>
  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Accept"></a><a id="1385" href="Ledger.NewPP.html#1385" class="InductiveConstructor">NEWPP-Accept</a> <a id="1398" class="Symbol">:</a> <a id="1400" class="Symbol">∀</a> <a id="1402" class="Symbol">{</a><a id="1403" href="Ledger.NewPP.html#1403" class="Bound">Γ</a><a id="1404" class="Symbol">}</a> <a id="1406" class="Symbol">→</a> <a id="1408" class="Keyword">let</a> <a id="1412" class="Keyword">open</a> <a id="1417" href="Ledger.NewPP.html#422" class="Module">NewPParamState</a> <a id="1432" href="Ledger.NewPP.html#1174" class="Generalizable">s</a><a id="1433" class="Symbol">;</a> <a id="1435" href="Ledger.NewPP.html#1435" class="Bound">newpp</a> <a id="1441" class="Symbol">=</a> <a id="1443" href="Ledger.PParams.html#699" class="Function">applyUpdate</a> <a id="1455" href="Ledger.NewPP.html#479" class="Function">pparams</a> <a id="1463" href="Ledger.NewPP.html#1216" class="Generalizable">upd</a> <a id="1467" class="Keyword">in</a>
    <a id="1474" href="Ledger.PPUp.html#1257" class="Function">viablePParams</a> <a id="1488" href="Ledger.NewPP.html#1435" class="Bound">newpp</a>
    <a id="1498" href="Interface.ComputationalRelation.html#276" class="Function Operator">────────────────────────────────</a>
    <a id="1535" href="Ledger.NewPP.html#1403" class="Bound">Γ</a> <a id="1537" href="Ledger.NewPP.html#1242" class="Datatype Operator">⊢</a> <a id="1539" href="Ledger.NewPP.html#1174" class="Generalizable">s</a> <a id="1541" href="Ledger.NewPP.html#1242" class="Datatype Operator">⇀⦇</a> <a id="1544" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1549" href="Ledger.NewPP.html#1216" class="Generalizable">upd</a> <a id="1553" href="Ledger.NewPP.html#1242" class="Datatype Operator">,NEWPP⦈</a> <a id="1561" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">⟦</a> <a id="1563" href="Ledger.NewPP.html#1435" class="Bound">newpp</a> <a id="1569" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">,</a> <a id="1571" href="Ledger.NewPP.html#532" class="Function">updatePPUp</a> <a id="1582" href="Ledger.NewPP.html#1435" class="Bound">newpp</a> <a id="1588" href="Ledger.NewPP.html#506" class="Function">ppup</a> <a id="1593" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">⟧ⁿᵖ</a>

  <a id="_⊢_⇀⦇_,NEWPP⦈_.NEWPP-Reject"></a><a id="1600" href="Ledger.NewPP.html#1600" class="InductiveConstructor">NEWPP-Reject</a> <a id="1613" class="Symbol">:</a> <a id="1615" class="Symbol">∀</a> <a id="1617" class="Symbol">{</a><a id="1618" href="Ledger.NewPP.html#1618" class="Bound">Γ</a><a id="1619" class="Symbol">}</a> <a id="1621" class="Symbol">→</a> <a id="1623" class="Keyword">let</a> <a id="1627" class="Keyword">open</a> <a id="1632" href="Ledger.NewPP.html#422" class="Module">NewPParamState</a> <a id="1647" href="Ledger.NewPP.html#1174" class="Generalizable">s</a> <a id="1649" class="Keyword">in</a>
    <a id="1656" href="Ledger.NewPP.html#1618" class="Bound">Γ</a> <a id="1658" href="Ledger.NewPP.html#1242" class="Datatype Operator">⊢</a> <a id="1660" href="Ledger.NewPP.html#1174" class="Generalizable">s</a> <a id="1662" href="Ledger.NewPP.html#1242" class="Datatype Operator">⇀⦇</a> <a id="1665" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="1673" href="Ledger.NewPP.html#1242" class="Datatype Operator">,NEWPP⦈</a> <a id="1681" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">⟦</a> <a id="1683" href="Ledger.NewPP.html#479" class="Function">pparams</a> <a id="1691" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">,</a> <a id="1693" href="Ledger.NewPP.html#532" class="Function">updatePPUp</a> <a id="1704" href="Ledger.NewPP.html#1198" class="Generalizable">newpp</a> <a id="1710" href="Ledger.NewPP.html#506" class="Function">ppup</a> <a id="1715" href="Ledger.NewPP.html#463" class="InductiveConstructor Operator">⟧ⁿᵖ</a>
<a id="1719" class="Markup">\end{code}</a><a id="1729" class="Background">
\caption{NEWPP transition system}
\end{figure*}
</a></pre></body></html>